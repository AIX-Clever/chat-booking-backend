
# Scalars
scalar AWSDateTime
scalar AWSJSON

# Enums
enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  NO_SHOW
}

enum PaymentStatus {
  NONE
  PENDING
  PAID
  FAILED
}

enum ConversationState {
  INIT
  SERVICE_PENDING
  SERVICE_SELECTED
  PROVIDER_PENDING
  PROVIDER_SELECTED
  SLOT_PENDING
  CONFIRM_PENDING
  BOOKING_CONFIRMED
}


# Types - Tenant
enum TenantStatus {
  ACTIVE
  SUSPENDED
  CANCELLED
}

enum TenantPlan {
  LITE
  PRO
  BUSINESS
  ENTERPRISE
}

type Tenant @aws_api_key @aws_cognito_user_pools {
  tenantId: ID!
  name: String!
  slug: String!
  status: TenantStatus!
  plan: TenantPlan!
  ownerUserId: String!
  billingEmail: String!
  settings: AWSJSON
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

type ApiKey {
  apiKey: String!
  tenantId: ID!
  status: String!
  createdAt: AWSDateTime!
  expiresAt: AWSDateTime!
}

type FAQ @aws_api_key @aws_cognito_user_pools {
  faqId: ID!
  tenantId: ID!
  question: String!
  answer: String!
  category: String!
  active: Boolean!
}

# Types - Dashboard Metrics
type DashboardSummary @aws_cognito_user_pools {
  revenue: Float!
  bookings: Int!
  messages: Int!
  tokensIA: Int!
  conversionsChat: Int!
  aiResponses: Int!
  conversionRate: Float!
  autoAttendanceRate: Float!
}

type DailyMetric @aws_cognito_user_pools {
  date: String!
  bookings: Int!
  messages: Int!
}

type TopService @aws_cognito_user_pools {
  serviceId: ID!
  name: String!
  bookings: Int!
}

type TopProvider @aws_cognito_user_pools {
  providerId: ID!
  name: String!
  bookings: Int!
}

type BookingStatusCounts @aws_cognito_user_pools {
  CONFIRMED: Int!
  PENDING: Int!
  CANCELLED: Int!
  NO_SHOW: Int!
}

type MetricError @aws_cognito_user_pools {
  type: String!
  count: Int!
  lastOccurred: String
}

type DashboardMetrics @aws_cognito_user_pools {
  period: String!
  summary: DashboardSummary!
  daily: [DailyMetric!]!
  topServices: [TopService!]!
  topProviders: [TopProvider!]!
  bookingStatus: BookingStatusCounts!
  errors: [MetricError!]!
}

type PlanUsage @aws_cognito_user_pools {
  messages: Int!
  bookings: Int!
  tokensIA: Int!
}

# Types - Catalog
type Category @aws_api_key @aws_cognito_user_pools {
  categoryId: ID!
  tenantId: ID!
  name: String!
  description: String
  isActive: Boolean!
  displayOrder: Int
  metadata: AWSJSON
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

type Service @aws_api_key @aws_cognito_user_pools {
  serviceId: ID!
  name: String!
  description: String
  category: String!
  durationMinutes: Int!
  price: Float
  available: Boolean!
}

type Provider @aws_api_key @aws_cognito_user_pools {
  providerId: ID!
  name: String!
  bio: String
  serviceIds: [ID!]!
  timezone: String!
  metadata: AWSJSON
  available: Boolean!
}

# Types - Availability
type TimeSlot @aws_api_key @aws_cognito_user_pools {
  providerId: ID!
  serviceId: ID!
  start: AWSDateTime!
  end: AWSDateTime!
  isAvailable: Boolean!
}

type TimeRange @aws_api_key @aws_cognito_user_pools {
  startTime: String!
  endTime: String!
}

type ProviderAvailability @aws_cognito_user_pools {
  providerId: ID!
  dayOfWeek: String!
  timeRanges: [TimeRange!]!
  breaks: [TimeRange!]
  exceptions: [String!]
}

# Types - Bookings
type Booking @aws_api_key @aws_cognito_user_pools {
  bookingId: ID!
  tenantId: ID!
  serviceId: ID!
  providerId: ID!
  start: AWSDateTime!
  end: AWSDateTime!
  status: BookingStatus!
  clientName: String!
  clientEmail: String!
  clientPhone: String
  notes: String
  conversationId: ID
  paymentStatus: PaymentStatus!
  totalAmount: Float!
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

# Types - Chat
type Message @aws_api_key {
  role: String!
  content: String!
  type: String!
  timestamp: String!
}

type Conversation @aws_api_key {
  conversationId: ID!
  tenantId: ID!
  state: ConversationState!
  context: AWSJSON
  messages: [Message!]!
  channel: String!
  metadata: AWSJSON
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

type ChatResponse @aws_api_key {
  conversation: Conversation!
  response: AWSJSON!
}

# Types - Workflow
type WorkflowStep @aws_cognito_user_pools {
  stepId: String!
  type: String!
  content: AWSJSON
  next: String
}

type Workflow @aws_cognito_user_pools {
  workflowId: ID!
  tenantId: ID!
  name: String!
  description: String
  isActive: Boolean!
  steps: AWSJSON! # JSON object with map of steps
  metadata: AWSJSON
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}


# Inputs - Tenant
input RegisterTenantInput {
  companyName: String!
  email: String!
  password: String!
}

input UpdateTenantInput {
  name: String
  billingEmail: String
  settings: AWSJSON
}

# Inputs - FAQs
input CreateFAQInput {
  question: String!
  answer: String!
  category: String
  active: Boolean
}

input UpdateFAQInput {
  faqId: ID!
  question: String
  answer: String
  category: String
  active: Boolean
}

# Inputs - Catalog
input CreateCategoryInput {
  name: String!
  description: String
  isActive: Boolean
  displayOrder: Int
  metadata: AWSJSON
}

input UpdateCategoryInput {
  categoryId: ID!
  name: String
  description: String
  isActive: Boolean
  displayOrder: Int
  metadata: AWSJSON
}

input CreateServiceInput {
  name: String!
  description: String
  category: String!
  durationMinutes: Int!
  price: Float
}

input UpdateServiceInput {
  serviceId: ID!
  name: String
  description: String
  category: String
  durationMinutes: Int
  price: Float
  available: Boolean
}

input CreateProviderInput {
  name: String!
  bio: String
  serviceIds: [ID!]!
  timezone: String!
  metadata: AWSJSON
}

input UpdateProviderInput {
  providerId: ID!
  name: String
  bio: String
  serviceIds: [ID!]
  timezone: String
  metadata: AWSJSON
  available: Boolean
}

# Inputs - Availability
input GetAvailableSlotsInput {
  serviceId: ID!
  providerId: ID!
  from: AWSDateTime!
  to: AWSDateTime!
}

input TimeRangeInput {
  startTime: String!
  endTime: String!
}

input SetAvailabilityInput {
  providerId: ID!
  dayOfWeek: String!
  timeRanges: [TimeRangeInput!]!
  breaks: [TimeRangeInput!]
}

input SetExceptionsInput {
  providerId: ID!
  exceptions: [String!]!
}

type ProviderExceptions @aws_cognito_user_pools {
  providerId: ID!
  exceptions: [String!]!
}

# Inputs - Bookings
input CreateBookingInput {
  serviceId: ID!
  providerId: ID!
  start: AWSDateTime!
  end: AWSDateTime!
  clientName: String!
  clientEmail: String!
  clientPhone: String
  notes: String
  conversationId: ID
}

input ConfirmBookingInput {
  bookingId: ID!
  tenantId: ID
}

input CancelBookingInput {
  bookingId: ID!
  reason: String
  tenantId: ID
}

input GetBookingInput {
  bookingId: ID!
}

input ListBookingsByProviderInput {
  providerId: ID!
  startDate: AWSDateTime!
  endDate: AWSDateTime!
}

input ListBookingsByClientInput {
  clientEmail: String!
}

input GetBookingByConversationInput {
  conversationId: ID!
}

# Inputs - Chat
input StartConversationInput {
  channel: String
  metadata: AWSJSON
}

input SendMessageInput {
  conversationId: ID!
  message: String!
  messageType: String
  userData: AWSJSON
}

input ConfirmBookingFromConversationInput {
  conversationId: ID!
}

input GetConversationInput {
  conversationId: ID!
}

# Inputs - Workflow
input CreateWorkflowInput {
  name: String!
  description: String
  steps: AWSJSON!
  metadata: AWSJSON
  isActive: Boolean
}

input UpdateWorkflowInput {
  workflowId: ID!
  name: String
  description: String
  steps: AWSJSON
  metadata: AWSJSON
  isActive: Boolean
}

# Queries
type Query {
  # Catalog
  listCategories(activeOnly: Boolean): [Category!]! @aws_api_key @aws_cognito_user_pools
  searchServices(text: String, availableOnly: Boolean): [Service!]! @aws_api_key @aws_cognito_user_pools
  getService(serviceId: ID!): Service @aws_api_key @aws_cognito_user_pools
  listProviders: [Provider!]! @aws_api_key @aws_cognito_user_pools
  listProvidersByService(serviceId: ID!): [Provider!]! @aws_api_key @aws_cognito_user_pools
  
  # Availability
  getAvailableSlots(input: GetAvailableSlotsInput!): [TimeSlot!]! @aws_api_key @aws_cognito_user_pools
  getProviderAvailability(providerId: ID!): [ProviderAvailability!]! @aws_cognito_user_pools
  
  # Bookings
  getBooking(input: GetBookingInput!): Booking @aws_api_key @aws_cognito_user_pools
  listBookingsByProvider(input: ListBookingsByProviderInput!): [Booking!]! @aws_cognito_user_pools
  listBookingsByClient(input: ListBookingsByClientInput!): [Booking!]! @aws_cognito_user_pools
  getBookingByConversation(input: GetBookingByConversationInput!): Booking @aws_api_key @aws_cognito_user_pools
  
  # Chat
  getConversation(input: GetConversationInput!): Conversation @aws_api_key @aws_cognito_user_pools
  getTenant(tenantId: ID): Tenant @aws_api_key @aws_cognito_user_pools
  listFAQs: [FAQ!]! @aws_api_key @aws_cognito_user_pools
  
  # Workflow (Admin)
  listWorkflows: [Workflow!]! @aws_cognito_user_pools
  getWorkflow(workflowId: ID!): Workflow @aws_cognito_user_pools

  # Dashboard Metrics (Admin)
  getDashboardMetrics: DashboardMetrics @aws_cognito_user_pools
  getPlanUsage: PlanUsage @aws_cognito_user_pools
}

# Mutations
type Mutation {
  # Tenant (Public/Auth)
  registerTenant(input: RegisterTenantInput!): Tenant! @aws_api_key
  updateTenant(input: UpdateTenantInput!): Tenant! @aws_cognito_user_pools

  # Catalog (Admin)
  createCategory(input: CreateCategoryInput!): Category! @aws_cognito_user_pools
  updateCategory(input: UpdateCategoryInput!): Category! @aws_cognito_user_pools
  deleteCategory(categoryId: ID!): Category! @aws_cognito_user_pools

  createService(input: CreateServiceInput!): Service! @aws_cognito_user_pools
  updateService(input: UpdateServiceInput!): Service! @aws_cognito_user_pools
  deleteService(serviceId: ID!): Service! @aws_cognito_user_pools
  
  createProvider(input: CreateProviderInput!): Provider! @aws_cognito_user_pools
  updateProvider(input: UpdateProviderInput!): Provider! @aws_cognito_user_pools
  deleteProvider(providerId: ID!): Provider! @aws_cognito_user_pools
  
  # Availability (Admin)
  setProviderAvailability(input: SetAvailabilityInput!): ProviderAvailability! @aws_cognito_user_pools
  setProviderExceptions(input: SetExceptionsInput!): ProviderExceptions! @aws_cognito_user_pools
  
  # FAQs (Admin)
  createFAQ(input: CreateFAQInput!): FAQ! @aws_cognito_user_pools
  updateFAQ(input: UpdateFAQInput!): FAQ! @aws_cognito_user_pools
  deleteFAQ(faqId: ID!): FAQ! @aws_cognito_user_pools

  # Workflows (Admin)
  createWorkflow(input: CreateWorkflowInput!): Workflow! @aws_cognito_user_pools
  updateWorkflow(input: UpdateWorkflowInput!): Workflow! @aws_cognito_user_pools
  deleteWorkflow(workflowId: ID!): Workflow! @aws_cognito_user_pools

  # Documents (Knowledge Base)
  getUploadUrl(fileName: String!, contentType: String!): String! @aws_cognito_user_pools

  # Bookings
  createBooking(input: CreateBookingInput!): Booking! @aws_api_key @aws_cognito_user_pools
  confirmBooking(input: ConfirmBookingInput!): Booking! @aws_cognito_user_pools
  cancelBooking(input: CancelBookingInput!): Booking! @aws_cognito_user_pools
  markAsNoShow(bookingId: ID!): Booking! @aws_cognito_user_pools
  
  # Chat
  startConversation(input: StartConversationInput!): ChatResponse! @aws_api_key
  sendMessage(input: SendMessageInput!): ChatResponse! @aws_api_key
  confirmBookingFromConversation(input: ConfirmBookingFromConversationInput!): ChatResponse! @aws_api_key
}

schema {
  query: Query
  mutation: Mutation
}
