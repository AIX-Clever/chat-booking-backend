
# Scalars
scalar AWSDateTime
scalar AWSJSON

# Enums
enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  NO_SHOW
}

enum PaymentStatus {
  NONE
  PENDING
  PAID
  FAILED
}

enum ConversationState {
  INIT
  SERVICE_PENDING
  SERVICE_SELECTED
  PROVIDER_PENDING
  PROVIDER_SELECTED
  SLOT_PENDING
  CONFIRM_PENDING
  BOOKING_CONFIRMED
}


# Types - Tenant
enum TenantStatus {
  ACTIVE
  SUSPENDED
  CANCELLED
}

enum TenantPlan {
  FREE
  PRO
  BUSINESS
  ENTERPRISE
}

type Tenant @aws_api_key @aws_cognito_user_pools {
  tenantId: ID!
  name: String!
  slug: String!
  status: TenantStatus!
  plan: TenantPlan!
  ownerUserId: String!
  billingEmail: String!
  settings: AWSJSON
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

type ApiKey {
  apiKey: String!
  tenantId: ID!
  status: String!
  createdAt: AWSDateTime!
  expiresAt: AWSDateTime!
}

# Types - Catalog
type Category @aws_api_key @aws_cognito_user_pools {
  categoryId: ID!
  tenantId: ID!
  name: String!
  description: String
  isActive: Boolean!
  displayOrder: Int
  metadata: AWSJSON
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

type Service @aws_api_key @aws_cognito_user_pools {
  serviceId: ID!
  name: String!
  description: String
  category: String!
  durationMinutes: Int!
  price: Float
  available: Boolean!
}

type Provider @aws_api_key @aws_cognito_user_pools {
  providerId: ID!
  name: String!
  bio: String
  serviceIds: [ID!]!
  timezone: String!
  metadata: AWSJSON
  available: Boolean!
}

# Types - Availability
type TimeSlot @aws_api_key @aws_cognito_user_pools {
  providerId: ID!
  serviceId: ID!
  start: AWSDateTime!
  end: AWSDateTime!
  isAvailable: Boolean!
}

type TimeRange @aws_api_key @aws_cognito_user_pools {
  startTime: String!
  endTime: String!
}

type ProviderAvailability @aws_cognito_user_pools {
  providerId: ID!
  dayOfWeek: String!
  timeRanges: [TimeRange!]!
  breaks: [TimeRange!]
  exceptions: [String!]
}

# Types - Bookings
type Booking @aws_api_key @aws_cognito_user_pools {
  bookingId: ID!
  tenantId: ID!
  serviceId: ID!
  providerId: ID!
  start: AWSDateTime!
  end: AWSDateTime!
  status: BookingStatus!
  clientName: String!
  clientEmail: String!
  clientPhone: String
  notes: String
  conversationId: ID
  paymentStatus: PaymentStatus!
  totalAmount: Float!
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

# Types - Chat
type Message @aws_api_key {
  role: String!
  content: String!
  type: String!
  timestamp: String!
}

type Conversation @aws_api_key {
  conversationId: ID!
  tenantId: ID!
  state: ConversationState!
  context: AWSJSON
  messages: [Message!]!
  channel: String!
  metadata: AWSJSON
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

type ChatResponse @aws_api_key {
  conversation: Conversation!
  response: AWSJSON!
}

# Types - Workflows
enum WorkflowStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

type Workflow @aws_cognito_user_pools {
  workflowId: ID!
  tenantId: ID!
  name: String!
  description: String
  definition: AWSJSON!
  status: WorkflowStatus!
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}


# Inputs - Tenant
input RegisterTenantInput {
  companyName: String!
  email: String!
  password: String!
}

input UpdateTenantInput {
  name: String
  billingEmail: String
  settings: AWSJSON
}

# Inputs - Catalog
input CreateCategoryInput {
  name: String!
  description: String
  isActive: Boolean
  displayOrder: Int
  metadata: AWSJSON
}

input UpdateCategoryInput {
  categoryId: ID!
  name: String
  description: String
  isActive: Boolean
  displayOrder: Int
  metadata: AWSJSON
}

input CreateServiceInput {
  name: String!
  description: String
  category: String!
  durationMinutes: Int!
  price: Float
}

input UpdateServiceInput {
  serviceId: ID!
  name: String
  description: String
  category: String
  durationMinutes: Int
  price: Float
  available: Boolean
}

input CreateProviderInput {
  name: String!
  bio: String
  serviceIds: [ID!]!
  timezone: String!
  metadata: AWSJSON
}

input UpdateProviderInput {
  providerId: ID!
  name: String
  bio: String
  serviceIds: [ID!]
  timezone: String
  metadata: AWSJSON
  available: Boolean
}

# Inputs - Availability
input GetAvailableSlotsInput {
  serviceId: ID!
  providerId: ID!
  from: AWSDateTime!
  to: AWSDateTime!
}

input TimeRangeInput {
  startTime: String!
  endTime: String!
}

input SetAvailabilityInput {
  providerId: ID!
  dayOfWeek: String!
  timeRanges: [TimeRangeInput!]!
  breaks: [TimeRangeInput!]
  exceptions: [String!]
}

# Inputs - Bookings
input CreateBookingInput {
  serviceId: ID!
  providerId: ID!
  start: AWSDateTime!
  end: AWSDateTime!
  clientName: String!
  clientEmail: String!
  clientPhone: String
  notes: String
  conversationId: ID
}

input ConfirmBookingInput {
  bookingId: ID!
}

input CancelBookingInput {
  bookingId: ID!
  reason: String
}

input GetBookingInput {
  bookingId: ID!
}

input ListBookingsByProviderInput {
  providerId: ID!
  startDate: AWSDateTime!
  endDate: AWSDateTime!
}

input ListBookingsByClientInput {
  clientEmail: String!
}

input GetBookingByConversationInput {
  conversationId: ID!
}

# Inputs - Chat
input StartConversationInput {
  channel: String
  metadata: AWSJSON
}

input SendMessageInput {
  conversationId: ID!
  message: String!
  messageType: String
  userData: AWSJSON
}

input ConfirmBookingFromConversationInput {
  conversationId: ID!
}

input GetConversationInput {
  conversationId: ID!
}

# Inputs - Workflows
input CreateWorkflowInput {
  name: String!
  description: String
  definition: AWSJSON!
  status: WorkflowStatus
}

input UpdateWorkflowInput {
  workflowId: ID!
  name: String
  description: String
  definition: AWSJSON
  status: WorkflowStatus
}

# Queries
type Query {
  # Catalog
  listCategories(activeOnly: Boolean): [Category!]! @aws_api_key @aws_cognito_user_pools
  searchServices(text: String, availableOnly: Boolean): [Service!]! @aws_api_key @aws_cognito_user_pools
  getService(serviceId: ID!): Service @aws_api_key @aws_cognito_user_pools
  listProviders: [Provider!]! @aws_api_key @aws_cognito_user_pools
  listProvidersByService(serviceId: ID!): [Provider!]! @aws_api_key @aws_cognito_user_pools
  
  # Availability
  getAvailableSlots(input: GetAvailableSlotsInput!): [TimeSlot!]! @aws_api_key @aws_cognito_user_pools
  getProviderAvailability(providerId: ID!): [ProviderAvailability!]! @aws_cognito_user_pools
  
  # Bookings
  getBooking(input: GetBookingInput!): Booking @aws_api_key @aws_cognito_user_pools
  listBookingsByProvider(input: ListBookingsByProviderInput!): [Booking!]! @aws_cognito_user_pools
  listBookingsByClient(input: ListBookingsByClientInput!): [Booking!]! @aws_cognito_user_pools
  getBookingByConversation(input: GetBookingByConversationInput!): Booking @aws_api_key @aws_cognito_user_pools
  
  # Chat
  getConversation(input: GetConversationInput!): Conversation @aws_api_key @aws_cognito_user_pools
  getTenant(tenantId: ID): Tenant @aws_api_key @aws_cognito_user_pools
  
  # Workflows
  listWorkflows: [Workflow!]! @aws_cognito_user_pools
  getWorkflow(workflowId: ID!): Workflow @aws_cognito_user_pools
}

# Mutations
type Mutation {
  # Tenant (Public/Auth)
  # Tenant (Public/Auth)
  registerTenant(input: RegisterTenantInput!): Tenant! @aws_api_key
  updateTenant(input: UpdateTenantInput!): Tenant! @aws_cognito_user_pools

  # Catalog (Admin)
  createCategory(input: CreateCategoryInput!): Category! @aws_cognito_user_pools
  updateCategory(input: UpdateCategoryInput!): Category! @aws_cognito_user_pools
  deleteCategory(categoryId: ID!): Category! @aws_cognito_user_pools

  createService(input: CreateServiceInput!): Service! @aws_cognito_user_pools
  updateService(input: UpdateServiceInput!): Service! @aws_cognito_user_pools
  deleteService(serviceId: ID!): Service! @aws_cognito_user_pools
  
  createProvider(input: CreateProviderInput!): Provider! @aws_cognito_user_pools
  updateProvider(input: UpdateProviderInput!): Provider! @aws_cognito_user_pools
  deleteProvider(providerId: ID!): Provider! @aws_cognito_user_pools
  
  # Availability (Admin)
  setProviderAvailability(input: SetAvailabilityInput!): ProviderAvailability! @aws_cognito_user_pools
  
  # Bookings
  createBooking(input: CreateBookingInput!): Booking! @aws_api_key @aws_cognito_user_pools
  confirmBooking(input: ConfirmBookingInput!): Booking! @aws_cognito_user_pools
  cancelBooking(input: CancelBookingInput!): Booking! @aws_cognito_user_pools
  
  # Chat
  sendMessage(input: SendMessageInput!): ChatResponse! @aws_api_key
  confirmBookingFromConversation(input: ConfirmBookingFromConversationInput!): ChatResponse! @aws_api_key
  
  # Workflows
  createWorkflow(input: CreateWorkflowInput!): Workflow! @aws_cognito_user_pools
  updateWorkflow(input: UpdateWorkflowInput!): Workflow! @aws_cognito_user_pools
  deleteWorkflow(workflowId: ID!): Workflow! @aws_cognito_user_pools
}

schema {
  query: Query
  mutation: Mutation
}
