{
 "Description": "Lambda functions for Chat Booking SaaS",
 "Resources": {
  "SharedLayer27DFABF0": {
   "Type": "AWS::Lambda::LayerVersion",
   "Properties": {
    "CompatibleRuntimes": [
     "python3.11"
    ],
    "Content": {
     "S3Bucket": {
      "Fn::Sub": "cdk-hnb659fds-assets-${AWS::AccountId}-us-east-1"
     },
     "S3Key": "23e348f157ce38ad17ba4a1156bf28b778af2bd53891f9748f9d24283361301f.zip"
    },
    "Description": "Shared domain entities, repositories, and utilities"
   },
   "Metadata": {
    "aws:cdk:path": "ChatBooking-dev-Lambda/SharedLayer/Resource",
    "aws:asset:path": "asset.23e348f157ce38ad17ba4a1156bf28b778af2bd53891f9748f9d24283361301f",
    "aws:asset:is-bundled": false,
    "aws:asset:property": "Content"
   }
  },
  "AuthResolverFunctionServiceRoleE466CDE6": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
       ]
      ]
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "ChatBooking-dev-Lambda/AuthResolverFunction/ServiceRole/Resource"
   }
  },
  "AuthResolverFunctionServiceRoleDefaultPolicyA6F0ED5F": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "dynamodb:BatchGetItem",
        "dynamodb:ConditionCheckItem",
        "dynamodb:DescribeTable",
        "dynamodb:GetItem",
        "dynamodb:GetRecords",
        "dynamodb:GetShardIterator",
        "dynamodb:Query",
        "dynamodb:Scan"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputFnGetAttTenantsTableB701DC57ArnFFAEC087"
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputFnGetAttTenantsTableB701DC57ArnFFAEC087"
           },
           "/index/*"
          ]
         ]
        }
       ]
      },
      {
       "Action": [
        "dynamodb:BatchGetItem",
        "dynamodb:BatchWriteItem",
        "dynamodb:ConditionCheckItem",
        "dynamodb:DeleteItem",
        "dynamodb:DescribeTable",
        "dynamodb:GetItem",
        "dynamodb:GetRecords",
        "dynamodb:GetShardIterator",
        "dynamodb:PutItem",
        "dynamodb:Query",
        "dynamodb:Scan",
        "dynamodb:UpdateItem"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputFnGetAttApiKeysTable9F4DC7E7ArnE84F3BB0"
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputFnGetAttApiKeysTable9F4DC7E7ArnE84F3BB0"
           },
           "/index/*"
          ]
         ]
        }
       ]
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "AuthResolverFunctionServiceRoleDefaultPolicyA6F0ED5F",
    "Roles": [
     {
      "Ref": "AuthResolverFunctionServiceRoleE466CDE6"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "ChatBooking-dev-Lambda/AuthResolverFunction/ServiceRole/DefaultPolicy/Resource"
   }
  },
  "AuthResolverFunction9D28D29B": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": {
      "Fn::Sub": "cdk-hnb659fds-assets-${AWS::AccountId}-us-east-1"
     },
     "S3Key": "98e4e50395f53359ce127b4085446d99dde8127a187678fb7be4304d99720cdd.zip"
    },
    "Description": "AppSync authorizer - validates API keys and returns tenant context",
    "Environment": {
     "Variables": {
      "TENANTS_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefTenantsTableB701DC57BE8E768B"
      },
      "API_KEYS_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefApiKeysTable9F4DC7E79648F444"
      },
      "SERVICES_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefServicesTableF56E8DC54FC0C84D"
      },
      "PROVIDERS_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefProvidersTable1BBEDB6D429B9BF2"
      },
      "AVAILABILITY_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefAvailabilityTable497A1E6E14D99412"
      },
      "BOOKINGS_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefBookingsTableB262848587A36CBD"
      },
      "CONVERSATIONS_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefConversationsTableCD91EB96EE2E4585"
      },
      "CATEGORIES_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefCategoriesTable9FFF5A678A053E38"
      },
      "LOG_LEVEL": "INFO"
     }
    },
    "FunctionName": "ChatBooking-AuthResolver",
    "Handler": "handler.lambda_handler",
    "Layers": [
     {
      "Ref": "SharedLayer27DFABF0"
     }
    ],
    "MemorySize": 256,
    "Role": {
     "Fn::GetAtt": [
      "AuthResolverFunctionServiceRoleE466CDE6",
      "Arn"
     ]
    },
    "Runtime": "python3.11",
    "Timeout": 10
   },
   "DependsOn": [
    "AuthResolverFunctionServiceRoleDefaultPolicyA6F0ED5F",
    "AuthResolverFunctionServiceRoleE466CDE6"
   ],
   "Metadata": {
    "aws:cdk:path": "ChatBooking-dev-Lambda/AuthResolverFunction/Resource",
    "aws:asset:path": "asset.98e4e50395f53359ce127b4085446d99dde8127a187678fb7be4304d99720cdd",
    "aws:asset:is-bundled": false,
    "aws:asset:property": "Code"
   }
  },
  "AuthResolverFunctionLogRetentionC1D5A87F": {
   "Type": "Custom::LogRetention",
   "Properties": {
    "ServiceToken": {
     "Fn::GetAtt": [
      "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A",
      "Arn"
     ]
    },
    "LogGroupName": {
     "Fn::Join": [
      "",
      [
       "/aws/lambda/",
       {
        "Ref": "AuthResolverFunction9D28D29B"
       }
      ]
     ]
    },
    "RetentionInDays": 7
   },
   "Metadata": {
    "aws:cdk:path": "ChatBooking-dev-Lambda/AuthResolverFunction/LogRetention/Resource"
   }
  },
  "AuthResolverFunctionChatBookingApiappsync19DAFBBA": {
   "Type": "AWS::Lambda::Permission",
   "Properties": {
    "Action": "lambda:InvokeFunction",
    "FunctionName": {
     "Fn::GetAtt": [
      "AuthResolverFunction9D28D29B",
      "Arn"
     ]
    },
    "Principal": "appsync.amazonaws.com"
   },
   "Metadata": {
    "aws:cdk:path": "ChatBooking-dev-Lambda/AuthResolverFunction/ChatBookingApi-appsync"
   }
  },
  "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
       ]
      ]
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "ChatBooking-dev-Lambda/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/ServiceRole/Resource"
   }
  },
  "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRoleDefaultPolicyADDA7DEB": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "logs:DeleteRetentionPolicy",
        "logs:PutRetentionPolicy"
       ],
       "Effect": "Allow",
       "Resource": "*"
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRoleDefaultPolicyADDA7DEB",
    "Roles": [
     {
      "Ref": "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "ChatBooking-dev-Lambda/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/ServiceRole/DefaultPolicy/Resource"
   }
  },
  "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Handler": "index.handler",
    "Runtime": "nodejs22.x",
    "Timeout": 900,
    "Code": {
     "S3Bucket": {
      "Fn::Sub": "cdk-hnb659fds-assets-${AWS::AccountId}-us-east-1"
     },
     "S3Key": "2819175352ad1ce0dae768e83fc328fb70fb5f10b4a8ff0ccbcb791f02b0716d.zip"
    },
    "Role": {
     "Fn::GetAtt": [
      "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB",
      "Arn"
     ]
    }
   },
   "DependsOn": [
    "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRoleDefaultPolicyADDA7DEB",
    "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB"
   ],
   "Metadata": {
    "aws:cdk:path": "ChatBooking-dev-Lambda/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/Resource",
    "aws:asset:path": "asset.2819175352ad1ce0dae768e83fc328fb70fb5f10b4a8ff0ccbcb791f02b0716d",
    "aws:asset:is-bundled": false,
    "aws:asset:property": "Code"
   }
  },
  "CatalogFunctionServiceRoleAFF180B8": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
       ]
      ]
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "ChatBooking-dev-Lambda/CatalogFunction/ServiceRole/Resource"
   }
  },
  "CatalogFunctionServiceRoleDefaultPolicy36005DCA": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "dynamodb:BatchGetItem",
        "dynamodb:BatchWriteItem",
        "dynamodb:ConditionCheckItem",
        "dynamodb:DeleteItem",
        "dynamodb:DescribeTable",
        "dynamodb:GetItem",
        "dynamodb:GetRecords",
        "dynamodb:GetShardIterator",
        "dynamodb:PutItem",
        "dynamodb:Query",
        "dynamodb:Scan",
        "dynamodb:UpdateItem"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputFnGetAttCategoriesTable9FFF5A67Arn8D0D486E"
        },
        {
         "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputFnGetAttProvidersTable1BBEDB6DArn8763273B"
        },
        {
         "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputFnGetAttServicesTableF56E8DC5ArnE543C7F6"
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputFnGetAttProvidersTable1BBEDB6DArn8763273B"
           },
           "/index/*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputFnGetAttServicesTableF56E8DC5ArnE543C7F6"
           },
           "/index/*"
          ]
         ]
        }
       ]
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "CatalogFunctionServiceRoleDefaultPolicy36005DCA",
    "Roles": [
     {
      "Ref": "CatalogFunctionServiceRoleAFF180B8"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "ChatBooking-dev-Lambda/CatalogFunction/ServiceRole/DefaultPolicy/Resource"
   }
  },
  "CatalogFunctionCE342920": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": {
      "Fn::Sub": "cdk-hnb659fds-assets-${AWS::AccountId}-us-east-1"
     },
     "S3Key": "f0f452e7e3f267bb20a92bfafe9a528c6a785e9a43aa8ca65e883f41e04067fd.zip"
    },
    "Description": "Service and provider catalog management",
    "Environment": {
     "Variables": {
      "TENANTS_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefTenantsTableB701DC57BE8E768B"
      },
      "API_KEYS_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefApiKeysTable9F4DC7E79648F444"
      },
      "SERVICES_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefServicesTableF56E8DC54FC0C84D"
      },
      "PROVIDERS_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefProvidersTable1BBEDB6D429B9BF2"
      },
      "AVAILABILITY_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefAvailabilityTable497A1E6E14D99412"
      },
      "BOOKINGS_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefBookingsTableB262848587A36CBD"
      },
      "CONVERSATIONS_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefConversationsTableCD91EB96EE2E4585"
      },
      "CATEGORIES_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefCategoriesTable9FFF5A678A053E38"
      },
      "LOG_LEVEL": "INFO"
     }
    },
    "FunctionName": "ChatBooking-Catalog",
    "Handler": "handler.lambda_handler",
    "Layers": [
     {
      "Ref": "SharedLayer27DFABF0"
     }
    ],
    "MemorySize": 512,
    "Role": {
     "Fn::GetAtt": [
      "CatalogFunctionServiceRoleAFF180B8",
      "Arn"
     ]
    },
    "Runtime": "python3.11",
    "Timeout": 30
   },
   "DependsOn": [
    "CatalogFunctionServiceRoleDefaultPolicy36005DCA",
    "CatalogFunctionServiceRoleAFF180B8"
   ],
   "Metadata": {
    "aws:cdk:path": "ChatBooking-dev-Lambda/CatalogFunction/Resource",
    "aws:asset:path": "asset.f0f452e7e3f267bb20a92bfafe9a528c6a785e9a43aa8ca65e883f41e04067fd",
    "aws:asset:is-bundled": false,
    "aws:asset:property": "Code"
   }
  },
  "CatalogFunctionLogRetention6D7C6416": {
   "Type": "Custom::LogRetention",
   "Properties": {
    "ServiceToken": {
     "Fn::GetAtt": [
      "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A",
      "Arn"
     ]
    },
    "LogGroupName": {
     "Fn::Join": [
      "",
      [
       "/aws/lambda/",
       {
        "Ref": "CatalogFunctionCE342920"
       }
      ]
     ]
    },
    "RetentionInDays": 7
   },
   "Metadata": {
    "aws:cdk:path": "ChatBooking-dev-Lambda/CatalogFunction/LogRetention/Resource"
   }
  },
  "AvailabilityFunctionServiceRoleAED456A7": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
       ]
      ]
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "ChatBooking-dev-Lambda/AvailabilityFunction/ServiceRole/Resource"
   }
  },
  "AvailabilityFunctionServiceRoleDefaultPolicyF7AD321C": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "dynamodb:BatchGetItem",
        "dynamodb:BatchWriteItem",
        "dynamodb:ConditionCheckItem",
        "dynamodb:DeleteItem",
        "dynamodb:DescribeTable",
        "dynamodb:GetItem",
        "dynamodb:GetRecords",
        "dynamodb:GetShardIterator",
        "dynamodb:PutItem",
        "dynamodb:Query",
        "dynamodb:Scan",
        "dynamodb:UpdateItem"
       ],
       "Effect": "Allow",
       "Resource": {
        "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputFnGetAttAvailabilityTable497A1E6EArn6251D385"
       }
      },
      {
       "Action": [
        "dynamodb:BatchGetItem",
        "dynamodb:ConditionCheckItem",
        "dynamodb:DescribeTable",
        "dynamodb:GetItem",
        "dynamodb:GetRecords",
        "dynamodb:GetShardIterator",
        "dynamodb:Query",
        "dynamodb:Scan"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputFnGetAttBookingsTableB2628485Arn4FAB36A9"
        },
        {
         "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputFnGetAttProvidersTable1BBEDB6DArn8763273B"
        },
        {
         "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputFnGetAttServicesTableF56E8DC5ArnE543C7F6"
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputFnGetAttBookingsTableB2628485Arn4FAB36A9"
           },
           "/index/*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputFnGetAttProvidersTable1BBEDB6DArn8763273B"
           },
           "/index/*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputFnGetAttServicesTableF56E8DC5ArnE543C7F6"
           },
           "/index/*"
          ]
         ]
        }
       ]
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "AvailabilityFunctionServiceRoleDefaultPolicyF7AD321C",
    "Roles": [
     {
      "Ref": "AvailabilityFunctionServiceRoleAED456A7"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "ChatBooking-dev-Lambda/AvailabilityFunction/ServiceRole/DefaultPolicy/Resource"
   }
  },
  "AvailabilityFunction6B970752": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": {
      "Fn::Sub": "cdk-hnb659fds-assets-${AWS::AccountId}-us-east-1"
     },
     "S3Key": "a5c952bca3a920eddcaea8dfb04394986c1d993e6e41a09b4804dfbc1b5f9543.zip"
    },
    "Description": "Calculate available time slots for bookings",
    "Environment": {
     "Variables": {
      "TENANTS_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefTenantsTableB701DC57BE8E768B"
      },
      "API_KEYS_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefApiKeysTable9F4DC7E79648F444"
      },
      "SERVICES_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefServicesTableF56E8DC54FC0C84D"
      },
      "PROVIDERS_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefProvidersTable1BBEDB6D429B9BF2"
      },
      "AVAILABILITY_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefAvailabilityTable497A1E6E14D99412"
      },
      "BOOKINGS_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefBookingsTableB262848587A36CBD"
      },
      "CONVERSATIONS_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefConversationsTableCD91EB96EE2E4585"
      },
      "CATEGORIES_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefCategoriesTable9FFF5A678A053E38"
      },
      "LOG_LEVEL": "INFO",
      "SLOT_INTERVAL_MINUTES": "15"
     }
    },
    "FunctionName": "ChatBooking-Availability",
    "Handler": "handler.lambda_handler",
    "Layers": [
     {
      "Ref": "SharedLayer27DFABF0"
     }
    ],
    "MemorySize": 512,
    "Role": {
     "Fn::GetAtt": [
      "AvailabilityFunctionServiceRoleAED456A7",
      "Arn"
     ]
    },
    "Runtime": "python3.11",
    "Timeout": 30
   },
   "DependsOn": [
    "AvailabilityFunctionServiceRoleDefaultPolicyF7AD321C",
    "AvailabilityFunctionServiceRoleAED456A7"
   ],
   "Metadata": {
    "aws:cdk:path": "ChatBooking-dev-Lambda/AvailabilityFunction/Resource",
    "aws:asset:path": "asset.a5c952bca3a920eddcaea8dfb04394986c1d993e6e41a09b4804dfbc1b5f9543",
    "aws:asset:is-bundled": false,
    "aws:asset:property": "Code"
   }
  },
  "AvailabilityFunctionLogRetention54C6C74D": {
   "Type": "Custom::LogRetention",
   "Properties": {
    "ServiceToken": {
     "Fn::GetAtt": [
      "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A",
      "Arn"
     ]
    },
    "LogGroupName": {
     "Fn::Join": [
      "",
      [
       "/aws/lambda/",
       {
        "Ref": "AvailabilityFunction6B970752"
       }
      ]
     ]
    },
    "RetentionInDays": 7
   },
   "Metadata": {
    "aws:cdk:path": "ChatBooking-dev-Lambda/AvailabilityFunction/LogRetention/Resource"
   }
  },
  "BookingFunctionServiceRole0235703D": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
       ]
      ]
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "ChatBooking-dev-Lambda/BookingFunction/ServiceRole/Resource"
   }
  },
  "BookingFunctionServiceRoleDefaultPolicy8C2B4CBE": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "dynamodb:BatchGetItem",
        "dynamodb:BatchWriteItem",
        "dynamodb:ConditionCheckItem",
        "dynamodb:DeleteItem",
        "dynamodb:DescribeTable",
        "dynamodb:GetItem",
        "dynamodb:GetRecords",
        "dynamodb:GetShardIterator",
        "dynamodb:PutItem",
        "dynamodb:Query",
        "dynamodb:Scan",
        "dynamodb:UpdateItem"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputFnGetAttBookingsTableB2628485Arn4FAB36A9"
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputFnGetAttBookingsTableB2628485Arn4FAB36A9"
           },
           "/index/*"
          ]
         ]
        }
       ]
      },
      {
       "Action": [
        "dynamodb:BatchGetItem",
        "dynamodb:ConditionCheckItem",
        "dynamodb:DescribeTable",
        "dynamodb:GetItem",
        "dynamodb:GetRecords",
        "dynamodb:GetShardIterator",
        "dynamodb:Query",
        "dynamodb:Scan"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputFnGetAttConversationsTableCD91EB96Arn4A2B28C6"
        },
        {
         "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputFnGetAttProvidersTable1BBEDB6DArn8763273B"
        },
        {
         "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputFnGetAttServicesTableF56E8DC5ArnE543C7F6"
        },
        {
         "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputFnGetAttTenantsTableB701DC57ArnFFAEC087"
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputFnGetAttConversationsTableCD91EB96Arn4A2B28C6"
           },
           "/index/*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputFnGetAttProvidersTable1BBEDB6DArn8763273B"
           },
           "/index/*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputFnGetAttServicesTableF56E8DC5ArnE543C7F6"
           },
           "/index/*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputFnGetAttTenantsTableB701DC57ArnFFAEC087"
           },
           "/index/*"
          ]
         ]
        }
       ]
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "BookingFunctionServiceRoleDefaultPolicy8C2B4CBE",
    "Roles": [
     {
      "Ref": "BookingFunctionServiceRole0235703D"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "ChatBooking-dev-Lambda/BookingFunction/ServiceRole/DefaultPolicy/Resource"
   }
  },
  "BookingFunctionBDD6B8BC": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": {
      "Fn::Sub": "cdk-hnb659fds-assets-${AWS::AccountId}-us-east-1"
     },
     "S3Key": "291a834d06b18284467743483a885a270026a9adb3e432a73ee7017a5b209f52.zip"
    },
    "Description": "Booking creation, confirmation, and cancellation",
    "Environment": {
     "Variables": {
      "TENANTS_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefTenantsTableB701DC57BE8E768B"
      },
      "API_KEYS_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefApiKeysTable9F4DC7E79648F444"
      },
      "SERVICES_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefServicesTableF56E8DC54FC0C84D"
      },
      "PROVIDERS_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefProvidersTable1BBEDB6D429B9BF2"
      },
      "AVAILABILITY_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefAvailabilityTable497A1E6E14D99412"
      },
      "BOOKINGS_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefBookingsTableB262848587A36CBD"
      },
      "CONVERSATIONS_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefConversationsTableCD91EB96EE2E4585"
      },
      "CATEGORIES_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefCategoriesTable9FFF5A678A053E38"
      },
      "LOG_LEVEL": "INFO"
     }
    },
    "FunctionName": "ChatBooking-Booking",
    "Handler": "handler.lambda_handler",
    "Layers": [
     {
      "Ref": "SharedLayer27DFABF0"
     }
    ],
    "MemorySize": 512,
    "Role": {
     "Fn::GetAtt": [
      "BookingFunctionServiceRole0235703D",
      "Arn"
     ]
    },
    "Runtime": "python3.11",
    "Timeout": 60
   },
   "DependsOn": [
    "BookingFunctionServiceRoleDefaultPolicy8C2B4CBE",
    "BookingFunctionServiceRole0235703D"
   ],
   "Metadata": {
    "aws:cdk:path": "ChatBooking-dev-Lambda/BookingFunction/Resource",
    "aws:asset:path": "asset.291a834d06b18284467743483a885a270026a9adb3e432a73ee7017a5b209f52",
    "aws:asset:is-bundled": false,
    "aws:asset:property": "Code"
   }
  },
  "BookingFunctionLogRetention2C3DFC8B": {
   "Type": "Custom::LogRetention",
   "Properties": {
    "ServiceToken": {
     "Fn::GetAtt": [
      "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A",
      "Arn"
     ]
    },
    "LogGroupName": {
     "Fn::Join": [
      "",
      [
       "/aws/lambda/",
       {
        "Ref": "BookingFunctionBDD6B8BC"
       }
      ]
     ]
    },
    "RetentionInDays": 7
   },
   "Metadata": {
    "aws:cdk:path": "ChatBooking-dev-Lambda/BookingFunction/LogRetention/Resource"
   }
  },
  "ChatAgentFunctionServiceRole385D1C13": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
       ]
      ]
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "ChatBooking-dev-Lambda/ChatAgentFunction/ServiceRole/Resource"
   }
  },
  "ChatAgentFunctionServiceRoleDefaultPolicy6BB568D2": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "dynamodb:BatchGetItem",
        "dynamodb:BatchWriteItem",
        "dynamodb:ConditionCheckItem",
        "dynamodb:DeleteItem",
        "dynamodb:DescribeTable",
        "dynamodb:GetItem",
        "dynamodb:GetRecords",
        "dynamodb:GetShardIterator",
        "dynamodb:PutItem",
        "dynamodb:Query",
        "dynamodb:Scan",
        "dynamodb:UpdateItem"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputFnGetAttBookingsTableB2628485Arn4FAB36A9"
        },
        {
         "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputFnGetAttConversationsTableCD91EB96Arn4A2B28C6"
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputFnGetAttBookingsTableB2628485Arn4FAB36A9"
           },
           "/index/*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputFnGetAttConversationsTableCD91EB96Arn4A2B28C6"
           },
           "/index/*"
          ]
         ]
        }
       ]
      },
      {
       "Action": [
        "dynamodb:BatchGetItem",
        "dynamodb:ConditionCheckItem",
        "dynamodb:DescribeTable",
        "dynamodb:GetItem",
        "dynamodb:GetRecords",
        "dynamodb:GetShardIterator",
        "dynamodb:Query",
        "dynamodb:Scan"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputFnGetAttAvailabilityTable497A1E6EArn6251D385"
        },
        {
         "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputFnGetAttProvidersTable1BBEDB6DArn8763273B"
        },
        {
         "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputFnGetAttServicesTableF56E8DC5ArnE543C7F6"
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputFnGetAttProvidersTable1BBEDB6DArn8763273B"
           },
           "/index/*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputFnGetAttServicesTableF56E8DC5ArnE543C7F6"
           },
           "/index/*"
          ]
         ]
        }
       ]
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "ChatAgentFunctionServiceRoleDefaultPolicy6BB568D2",
    "Roles": [
     {
      "Ref": "ChatAgentFunctionServiceRole385D1C13"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "ChatBooking-dev-Lambda/ChatAgentFunction/ServiceRole/DefaultPolicy/Resource"
   }
  },
  "ChatAgentFunction2B92A177": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": {
      "Fn::Sub": "cdk-hnb659fds-assets-${AWS::AccountId}-us-east-1"
     },
     "S3Key": "acd01e8d9d5b9642e0ee87f1c53059babeb369f1cf0304a64482dd54842d1156.zip"
    },
    "Description": "Conversational FSM agent for booking flow",
    "Environment": {
     "Variables": {
      "TENANTS_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefTenantsTableB701DC57BE8E768B"
      },
      "API_KEYS_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefApiKeysTable9F4DC7E79648F444"
      },
      "SERVICES_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefServicesTableF56E8DC54FC0C84D"
      },
      "PROVIDERS_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefProvidersTable1BBEDB6D429B9BF2"
      },
      "AVAILABILITY_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefAvailabilityTable497A1E6E14D99412"
      },
      "BOOKINGS_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefBookingsTableB262848587A36CBD"
      },
      "CONVERSATIONS_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefConversationsTableCD91EB96EE2E4585"
      },
      "CATEGORIES_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefCategoriesTable9FFF5A678A053E38"
      },
      "LOG_LEVEL": "INFO"
     }
    },
    "FunctionName": "ChatBooking-ChatAgent",
    "Handler": "handler.lambda_handler",
    "Layers": [
     {
      "Ref": "SharedLayer27DFABF0"
     }
    ],
    "MemorySize": 1024,
    "Role": {
     "Fn::GetAtt": [
      "ChatAgentFunctionServiceRole385D1C13",
      "Arn"
     ]
    },
    "Runtime": "python3.11",
    "Timeout": 60
   },
   "DependsOn": [
    "ChatAgentFunctionServiceRoleDefaultPolicy6BB568D2",
    "ChatAgentFunctionServiceRole385D1C13"
   ],
   "Metadata": {
    "aws:cdk:path": "ChatBooking-dev-Lambda/ChatAgentFunction/Resource",
    "aws:asset:path": "asset.acd01e8d9d5b9642e0ee87f1c53059babeb369f1cf0304a64482dd54842d1156",
    "aws:asset:is-bundled": false,
    "aws:asset:property": "Code"
   }
  },
  "ChatAgentFunctionLogRetentionFACDBF94": {
   "Type": "Custom::LogRetention",
   "Properties": {
    "ServiceToken": {
     "Fn::GetAtt": [
      "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A",
      "Arn"
     ]
    },
    "LogGroupName": {
     "Fn::Join": [
      "",
      [
       "/aws/lambda/",
       {
        "Ref": "ChatAgentFunction2B92A177"
       }
      ]
     ]
    },
    "RetentionInDays": 7
   },
   "Metadata": {
    "aws:cdk:path": "ChatBooking-dev-Lambda/ChatAgentFunction/LogRetention/Resource"
   }
  },
  "RegisterTenantFunctionServiceRoleDE02E8D9": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
       ]
      ]
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "ChatBooking-dev-Lambda/RegisterTenantFunction/ServiceRole/Resource"
   }
  },
  "RegisterTenantFunctionServiceRoleDefaultPolicy86737BB7": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "dynamodb:BatchGetItem",
        "dynamodb:BatchWriteItem",
        "dynamodb:ConditionCheckItem",
        "dynamodb:DeleteItem",
        "dynamodb:DescribeTable",
        "dynamodb:GetItem",
        "dynamodb:GetRecords",
        "dynamodb:GetShardIterator",
        "dynamodb:PutItem",
        "dynamodb:Query",
        "dynamodb:Scan",
        "dynamodb:UpdateItem"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputFnGetAttApiKeysTable9F4DC7E7ArnE84F3BB0"
        },
        {
         "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputFnGetAttTenantsTableB701DC57ArnFFAEC087"
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputFnGetAttApiKeysTable9F4DC7E7ArnE84F3BB0"
           },
           "/index/*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputFnGetAttTenantsTableB701DC57ArnFFAEC087"
           },
           "/index/*"
          ]
         ]
        }
       ]
      },
      {
       "Action": [
        "cognito-idp:AdminCreateUser",
        "cognito-idp:AdminSetUserPassword"
       ],
       "Effect": "Allow",
       "Resource": {
        "Fn::ImportValue": "ChatBooking-dev-Auth:ExportsOutputFnGetAttAdminUserPoolD0AF18CFArnBE306E57"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "RegisterTenantFunctionServiceRoleDefaultPolicy86737BB7",
    "Roles": [
     {
      "Ref": "RegisterTenantFunctionServiceRoleDE02E8D9"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "ChatBooking-dev-Lambda/RegisterTenantFunction/ServiceRole/DefaultPolicy/Resource"
   }
  },
  "RegisterTenantFunctionBE8E1377": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": {
      "Fn::Sub": "cdk-hnb659fds-assets-${AWS::AccountId}-us-east-1"
     },
     "S3Key": "00b5e29bd63892271ed1ee9ba508690e5820d6b9467a1d5b33cb89c9e14b2abc.zip"
    },
    "Description": "Public tenant registration endpoint",
    "Environment": {
     "Variables": {
      "TENANTS_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefTenantsTableB701DC57BE8E768B"
      },
      "API_KEYS_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefApiKeysTable9F4DC7E79648F444"
      },
      "SERVICES_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefServicesTableF56E8DC54FC0C84D"
      },
      "PROVIDERS_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefProvidersTable1BBEDB6D429B9BF2"
      },
      "AVAILABILITY_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefAvailabilityTable497A1E6E14D99412"
      },
      "BOOKINGS_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefBookingsTableB262848587A36CBD"
      },
      "CONVERSATIONS_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefConversationsTableCD91EB96EE2E4585"
      },
      "CATEGORIES_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefCategoriesTable9FFF5A678A053E38"
      },
      "LOG_LEVEL": "INFO",
      "USER_POOL_ID": {
       "Fn::ImportValue": "ChatBooking-dev-Auth:ExportsOutputRefAdminUserPoolD0AF18CF79276EF5"
      }
     }
    },
    "FunctionName": "ChatBooking-RegisterTenant",
    "Handler": "handler.lambda_handler",
    "Layers": [
     {
      "Ref": "SharedLayer27DFABF0"
     }
    ],
    "MemorySize": 512,
    "Role": {
     "Fn::GetAtt": [
      "RegisterTenantFunctionServiceRoleDE02E8D9",
      "Arn"
     ]
    },
    "Runtime": "python3.11",
    "Timeout": 15
   },
   "DependsOn": [
    "RegisterTenantFunctionServiceRoleDefaultPolicy86737BB7",
    "RegisterTenantFunctionServiceRoleDE02E8D9"
   ],
   "Metadata": {
    "aws:cdk:path": "ChatBooking-dev-Lambda/RegisterTenantFunction/Resource",
    "aws:asset:path": "asset.00b5e29bd63892271ed1ee9ba508690e5820d6b9467a1d5b33cb89c9e14b2abc",
    "aws:asset:is-bundled": false,
    "aws:asset:property": "Code"
   }
  },
  "RegisterTenantFunctionLogRetentionD141423A": {
   "Type": "Custom::LogRetention",
   "Properties": {
    "ServiceToken": {
     "Fn::GetAtt": [
      "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A",
      "Arn"
     ]
    },
    "LogGroupName": {
     "Fn::Join": [
      "",
      [
       "/aws/lambda/",
       {
        "Ref": "RegisterTenantFunctionBE8E1377"
       }
      ]
     ]
    },
    "RetentionInDays": 7
   },
   "Metadata": {
    "aws:cdk:path": "ChatBooking-dev-Lambda/RegisterTenantFunction/LogRetention/Resource"
   }
  },
  "UpdateTenantFunctionServiceRole61716895": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
       ]
      ]
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "ChatBooking-dev-Lambda/UpdateTenantFunction/ServiceRole/Resource"
   }
  },
  "UpdateTenantFunctionServiceRoleDefaultPolicy299FDD14": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "dynamodb:BatchGetItem",
        "dynamodb:BatchWriteItem",
        "dynamodb:ConditionCheckItem",
        "dynamodb:DeleteItem",
        "dynamodb:DescribeTable",
        "dynamodb:GetItem",
        "dynamodb:GetRecords",
        "dynamodb:GetShardIterator",
        "dynamodb:PutItem",
        "dynamodb:Query",
        "dynamodb:Scan",
        "dynamodb:UpdateItem"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputFnGetAttTenantsTableB701DC57ArnFFAEC087"
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputFnGetAttTenantsTableB701DC57ArnFFAEC087"
           },
           "/index/*"
          ]
         ]
        }
       ]
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "UpdateTenantFunctionServiceRoleDefaultPolicy299FDD14",
    "Roles": [
     {
      "Ref": "UpdateTenantFunctionServiceRole61716895"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "ChatBooking-dev-Lambda/UpdateTenantFunction/ServiceRole/DefaultPolicy/Resource"
   }
  },
  "UpdateTenantFunction76E0A2E1": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": {
      "Fn::Sub": "cdk-hnb659fds-assets-${AWS::AccountId}-us-east-1"
     },
     "S3Key": "584c9386dd2b50eaab36496d704fc0e1491f9b2abee94a82aae94d0fb29f53ed.zip"
    },
    "Description": "Tenant settings update",
    "Environment": {
     "Variables": {
      "TENANTS_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefTenantsTableB701DC57BE8E768B"
      },
      "API_KEYS_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefApiKeysTable9F4DC7E79648F444"
      },
      "SERVICES_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefServicesTableF56E8DC54FC0C84D"
      },
      "PROVIDERS_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefProvidersTable1BBEDB6D429B9BF2"
      },
      "AVAILABILITY_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefAvailabilityTable497A1E6E14D99412"
      },
      "BOOKINGS_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefBookingsTableB262848587A36CBD"
      },
      "CONVERSATIONS_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefConversationsTableCD91EB96EE2E4585"
      },
      "CATEGORIES_TABLE": {
       "Fn::ImportValue": "ChatBooking-dev-Database:ExportsOutputRefCategoriesTable9FFF5A678A053E38"
      },
      "LOG_LEVEL": "INFO"
     }
    },
    "FunctionName": "ChatBooking-UpdateTenant",
    "Handler": "handler.lambda_handler",
    "Layers": [
     {
      "Ref": "SharedLayer27DFABF0"
     }
    ],
    "MemorySize": 512,
    "Role": {
     "Fn::GetAtt": [
      "UpdateTenantFunctionServiceRole61716895",
      "Arn"
     ]
    },
    "Runtime": "python3.11",
    "Timeout": 30
   },
   "DependsOn": [
    "UpdateTenantFunctionServiceRoleDefaultPolicy299FDD14",
    "UpdateTenantFunctionServiceRole61716895"
   ],
   "Metadata": {
    "aws:cdk:path": "ChatBooking-dev-Lambda/UpdateTenantFunction/Resource",
    "aws:asset:path": "asset.584c9386dd2b50eaab36496d704fc0e1491f9b2abee94a82aae94d0fb29f53ed",
    "aws:asset:is-bundled": false,
    "aws:asset:property": "Code"
   }
  },
  "UpdateTenantFunctionLogRetentionA321097A": {
   "Type": "Custom::LogRetention",
   "Properties": {
    "ServiceToken": {
     "Fn::GetAtt": [
      "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A",
      "Arn"
     ]
    },
    "LogGroupName": {
     "Fn::Join": [
      "",
      [
       "/aws/lambda/",
       {
        "Ref": "UpdateTenantFunction76E0A2E1"
       }
      ]
     ]
    },
    "RetentionInDays": 7
   },
   "Metadata": {
    "aws:cdk:path": "ChatBooking-dev-Lambda/UpdateTenantFunction/LogRetention/Resource"
   }
  },
  "AuthResolverErrorAlarm73C8A7D0": {
   "Type": "AWS::CloudWatch::Alarm",
   "Properties": {
    "AlarmDescription": "AuthResolver Lambda errors exceed threshold",
    "AlarmName": "ChatBooking-AuthResolver-Errors",
    "ComparisonOperator": "GreaterThanOrEqualToThreshold",
    "Dimensions": [
     {
      "Name": "FunctionName",
      "Value": {
       "Ref": "AuthResolverFunction9D28D29B"
      }
     }
    ],
    "EvaluationPeriods": 1,
    "MetricName": "Errors",
    "Namespace": "AWS/Lambda",
    "Period": 300,
    "Statistic": "Sum",
    "Threshold": 10,
    "TreatMissingData": "notBreaching"
   },
   "Metadata": {
    "aws:cdk:path": "ChatBooking-dev-Lambda/AuthResolverErrorAlarm/Resource"
   }
  },
  "AuthResolverThrottleAlarm9EB5BC62": {
   "Type": "AWS::CloudWatch::Alarm",
   "Properties": {
    "AlarmDescription": "AuthResolver Lambda throttles exceed threshold",
    "AlarmName": "ChatBooking-AuthResolver-Throttles",
    "ComparisonOperator": "GreaterThanOrEqualToThreshold",
    "Dimensions": [
     {
      "Name": "FunctionName",
      "Value": {
       "Ref": "AuthResolverFunction9D28D29B"
      }
     }
    ],
    "EvaluationPeriods": 1,
    "MetricName": "Throttles",
    "Namespace": "AWS/Lambda",
    "Period": 300,
    "Statistic": "Sum",
    "Threshold": 5,
    "TreatMissingData": "notBreaching"
   },
   "Metadata": {
    "aws:cdk:path": "ChatBooking-dev-Lambda/AuthResolverThrottleAlarm/Resource"
   }
  },
  "AuthResolverDurationAlarm74D432AA": {
   "Type": "AWS::CloudWatch::Alarm",
   "Properties": {
    "AlarmDescription": "AuthResolver Lambda duration high (P99)",
    "AlarmName": "ChatBooking-AuthResolver-Duration",
    "ComparisonOperator": "GreaterThanOrEqualToThreshold",
    "Dimensions": [
     {
      "Name": "FunctionName",
      "Value": {
       "Ref": "AuthResolverFunction9D28D29B"
      }
     }
    ],
    "EvaluationPeriods": 2,
    "ExtendedStatistic": "p99",
    "MetricName": "Duration",
    "Namespace": "AWS/Lambda",
    "Period": 300,
    "Threshold": 8000,
    "TreatMissingData": "notBreaching"
   },
   "Metadata": {
    "aws:cdk:path": "ChatBooking-dev-Lambda/AuthResolverDurationAlarm/Resource"
   }
  },
  "BookingErrorAlarm05A51076": {
   "Type": "AWS::CloudWatch::Alarm",
   "Properties": {
    "AlarmDescription": "Booking Lambda errors exceed threshold",
    "AlarmName": "ChatBooking-Booking-Errors",
    "ComparisonOperator": "GreaterThanOrEqualToThreshold",
    "Dimensions": [
     {
      "Name": "FunctionName",
      "Value": {
       "Ref": "BookingFunctionBDD6B8BC"
      }
     }
    ],
    "EvaluationPeriods": 1,
    "MetricName": "Errors",
    "Namespace": "AWS/Lambda",
    "Period": 300,
    "Statistic": "Sum",
    "Threshold": 10,
    "TreatMissingData": "notBreaching"
   },
   "Metadata": {
    "aws:cdk:path": "ChatBooking-dev-Lambda/BookingErrorAlarm/Resource"
   }
  },
  "BookingThrottleAlarmDD9065C4": {
   "Type": "AWS::CloudWatch::Alarm",
   "Properties": {
    "AlarmDescription": "Booking Lambda throttles exceed threshold",
    "AlarmName": "ChatBooking-Booking-Throttles",
    "ComparisonOperator": "GreaterThanOrEqualToThreshold",
    "Dimensions": [
     {
      "Name": "FunctionName",
      "Value": {
       "Ref": "BookingFunctionBDD6B8BC"
      }
     }
    ],
    "EvaluationPeriods": 1,
    "MetricName": "Throttles",
    "Namespace": "AWS/Lambda",
    "Period": 300,
    "Statistic": "Sum",
    "Threshold": 5,
    "TreatMissingData": "notBreaching"
   },
   "Metadata": {
    "aws:cdk:path": "ChatBooking-dev-Lambda/BookingThrottleAlarm/Resource"
   }
  },
  "BookingDurationAlarmD7F5501D": {
   "Type": "AWS::CloudWatch::Alarm",
   "Properties": {
    "AlarmDescription": "Booking Lambda duration high (P99)",
    "AlarmName": "ChatBooking-Booking-Duration",
    "ComparisonOperator": "GreaterThanOrEqualToThreshold",
    "Dimensions": [
     {
      "Name": "FunctionName",
      "Value": {
       "Ref": "BookingFunctionBDD6B8BC"
      }
     }
    ],
    "EvaluationPeriods": 2,
    "ExtendedStatistic": "p99",
    "MetricName": "Duration",
    "Namespace": "AWS/Lambda",
    "Period": 300,
    "Threshold": 48000,
    "TreatMissingData": "notBreaching"
   },
   "Metadata": {
    "aws:cdk:path": "ChatBooking-dev-Lambda/BookingDurationAlarm/Resource"
   }
  },
  "ChatAgentErrorAlarmA02737B7": {
   "Type": "AWS::CloudWatch::Alarm",
   "Properties": {
    "AlarmDescription": "ChatAgent Lambda errors exceed threshold",
    "AlarmName": "ChatBooking-ChatAgent-Errors",
    "ComparisonOperator": "GreaterThanOrEqualToThreshold",
    "Dimensions": [
     {
      "Name": "FunctionName",
      "Value": {
       "Ref": "ChatAgentFunction2B92A177"
      }
     }
    ],
    "EvaluationPeriods": 1,
    "MetricName": "Errors",
    "Namespace": "AWS/Lambda",
    "Period": 300,
    "Statistic": "Sum",
    "Threshold": 10,
    "TreatMissingData": "notBreaching"
   },
   "Metadata": {
    "aws:cdk:path": "ChatBooking-dev-Lambda/ChatAgentErrorAlarm/Resource"
   }
  },
  "ChatAgentThrottleAlarm6FDFEFF6": {
   "Type": "AWS::CloudWatch::Alarm",
   "Properties": {
    "AlarmDescription": "ChatAgent Lambda throttles exceed threshold",
    "AlarmName": "ChatBooking-ChatAgent-Throttles",
    "ComparisonOperator": "GreaterThanOrEqualToThreshold",
    "Dimensions": [
     {
      "Name": "FunctionName",
      "Value": {
       "Ref": "ChatAgentFunction2B92A177"
      }
     }
    ],
    "EvaluationPeriods": 1,
    "MetricName": "Throttles",
    "Namespace": "AWS/Lambda",
    "Period": 300,
    "Statistic": "Sum",
    "Threshold": 5,
    "TreatMissingData": "notBreaching"
   },
   "Metadata": {
    "aws:cdk:path": "ChatBooking-dev-Lambda/ChatAgentThrottleAlarm/Resource"
   }
  },
  "ChatAgentDurationAlarm606C1E59": {
   "Type": "AWS::CloudWatch::Alarm",
   "Properties": {
    "AlarmDescription": "ChatAgent Lambda duration high (P99)",
    "AlarmName": "ChatBooking-ChatAgent-Duration",
    "ComparisonOperator": "GreaterThanOrEqualToThreshold",
    "Dimensions": [
     {
      "Name": "FunctionName",
      "Value": {
       "Ref": "ChatAgentFunction2B92A177"
      }
     }
    ],
    "EvaluationPeriods": 2,
    "ExtendedStatistic": "p99",
    "MetricName": "Duration",
    "Namespace": "AWS/Lambda",
    "Period": 300,
    "Threshold": 48000,
    "TreatMissingData": "notBreaching"
   },
   "Metadata": {
    "aws:cdk:path": "ChatBooking-dev-Lambda/ChatAgentDurationAlarm/Resource"
   }
  },
  "RegisterTenantErrorAlarm27D2E1E8": {
   "Type": "AWS::CloudWatch::Alarm",
   "Properties": {
    "AlarmDescription": "RegisterTenant Lambda errors exceed threshold",
    "AlarmName": "ChatBooking-RegisterTenant-Errors",
    "ComparisonOperator": "GreaterThanOrEqualToThreshold",
    "Dimensions": [
     {
      "Name": "FunctionName",
      "Value": {
       "Ref": "RegisterTenantFunctionBE8E1377"
      }
     }
    ],
    "EvaluationPeriods": 1,
    "MetricName": "Errors",
    "Namespace": "AWS/Lambda",
    "Period": 300,
    "Statistic": "Sum",
    "Threshold": 10,
    "TreatMissingData": "notBreaching"
   },
   "Metadata": {
    "aws:cdk:path": "ChatBooking-dev-Lambda/RegisterTenantErrorAlarm/Resource"
   }
  },
  "RegisterTenantThrottleAlarmC32D63BD": {
   "Type": "AWS::CloudWatch::Alarm",
   "Properties": {
    "AlarmDescription": "RegisterTenant Lambda throttles exceed threshold",
    "AlarmName": "ChatBooking-RegisterTenant-Throttles",
    "ComparisonOperator": "GreaterThanOrEqualToThreshold",
    "Dimensions": [
     {
      "Name": "FunctionName",
      "Value": {
       "Ref": "RegisterTenantFunctionBE8E1377"
      }
     }
    ],
    "EvaluationPeriods": 1,
    "MetricName": "Throttles",
    "Namespace": "AWS/Lambda",
    "Period": 300,
    "Statistic": "Sum",
    "Threshold": 5,
    "TreatMissingData": "notBreaching"
   },
   "Metadata": {
    "aws:cdk:path": "ChatBooking-dev-Lambda/RegisterTenantThrottleAlarm/Resource"
   }
  },
  "RegisterTenantDurationAlarmDBA70416": {
   "Type": "AWS::CloudWatch::Alarm",
   "Properties": {
    "AlarmDescription": "RegisterTenant Lambda duration high (P99)",
    "AlarmName": "ChatBooking-RegisterTenant-Duration",
    "ComparisonOperator": "GreaterThanOrEqualToThreshold",
    "Dimensions": [
     {
      "Name": "FunctionName",
      "Value": {
       "Ref": "RegisterTenantFunctionBE8E1377"
      }
     }
    ],
    "EvaluationPeriods": 2,
    "ExtendedStatistic": "p99",
    "MetricName": "Duration",
    "Namespace": "AWS/Lambda",
    "Period": 300,
    "Threshold": 12000,
    "TreatMissingData": "notBreaching"
   },
   "Metadata": {
    "aws:cdk:path": "ChatBooking-dev-Lambda/RegisterTenantDurationAlarm/Resource"
   }
  },
  "CDKMetadata": {
   "Type": "AWS::CDK::Metadata",
   "Properties": {
    "Analytics": "v2:deflate64:H4sIAAAAAAAA/1WNzW7CMBCEn4W7s4XkxBGQekIqClKvaHG2qYl/Ku+6EbL87iimB3qabzWzMy20XQubFc7c6GFqrLlCPgvqSeHMl2zRXQeEfMQ7xU+KbIJXhy//735PXsuf8conis7wEimKuwsykzDsFlHcwT7piWSPTMqgg9wHS8tb1VOwRt9rS6WibBgZjmHsScjXCW1DGmYU/Q15ZzG6JV6hFFVnzoKj8aPqiUOK+ln/wh9JfpIU5cNAcOO333YNmy10qxsb08TkxTiC/qkPlAD9wiwBAAA="
   },
   "Metadata": {
    "aws:cdk:path": "ChatBooking-dev-Lambda/CDKMetadata/Default"
   }
  }
 },
 "Outputs": {
  "AuthResolverFunctionArn": {
   "Description": "Auth Resolver Lambda ARN",
   "Value": {
    "Fn::GetAtt": [
     "AuthResolverFunction9D28D29B",
     "Arn"
    ]
   }
  },
  "CatalogFunctionArn": {
   "Description": "Catalog Lambda ARN",
   "Value": {
    "Fn::GetAtt": [
     "CatalogFunctionCE342920",
     "Arn"
    ]
   }
  },
  "AvailabilityFunctionArn": {
   "Description": "Availability Lambda ARN",
   "Value": {
    "Fn::GetAtt": [
     "AvailabilityFunction6B970752",
     "Arn"
    ]
   }
  },
  "BookingFunctionArn": {
   "Description": "Booking Lambda ARN",
   "Value": {
    "Fn::GetAtt": [
     "BookingFunctionBDD6B8BC",
     "Arn"
    ]
   }
  },
  "ChatAgentFunctionArn": {
   "Description": "Chat Agent Lambda ARN",
   "Value": {
    "Fn::GetAtt": [
     "ChatAgentFunction2B92A177",
     "Arn"
    ]
   }
  },
  "ExportsOutputFnGetAttAuthResolverFunction9D28D29BArn5A0DACA2": {
   "Value": {
    "Fn::GetAtt": [
     "AuthResolverFunction9D28D29B",
     "Arn"
    ]
   },
   "Export": {
    "Name": "ChatBooking-dev-Lambda:ExportsOutputFnGetAttAuthResolverFunction9D28D29BArn5A0DACA2"
   }
  },
  "ExportsOutputFnGetAttCatalogFunctionCE342920Arn76EDCCB9": {
   "Value": {
    "Fn::GetAtt": [
     "CatalogFunctionCE342920",
     "Arn"
    ]
   },
   "Export": {
    "Name": "ChatBooking-dev-Lambda:ExportsOutputFnGetAttCatalogFunctionCE342920Arn76EDCCB9"
   }
  },
  "ExportsOutputFnGetAttAvailabilityFunction6B970752ArnA8773C46": {
   "Value": {
    "Fn::GetAtt": [
     "AvailabilityFunction6B970752",
     "Arn"
    ]
   },
   "Export": {
    "Name": "ChatBooking-dev-Lambda:ExportsOutputFnGetAttAvailabilityFunction6B970752ArnA8773C46"
   }
  },
  "ExportsOutputFnGetAttBookingFunctionBDD6B8BCArn85D621FD": {
   "Value": {
    "Fn::GetAtt": [
     "BookingFunctionBDD6B8BC",
     "Arn"
    ]
   },
   "Export": {
    "Name": "ChatBooking-dev-Lambda:ExportsOutputFnGetAttBookingFunctionBDD6B8BCArn85D621FD"
   }
  },
  "ExportsOutputFnGetAttChatAgentFunction2B92A177Arn6BACA9D2": {
   "Value": {
    "Fn::GetAtt": [
     "ChatAgentFunction2B92A177",
     "Arn"
    ]
   },
   "Export": {
    "Name": "ChatBooking-dev-Lambda:ExportsOutputFnGetAttChatAgentFunction2B92A177Arn6BACA9D2"
   }
  },
  "ExportsOutputFnGetAttRegisterTenantFunctionBE8E1377Arn1F9CA647": {
   "Value": {
    "Fn::GetAtt": [
     "RegisterTenantFunctionBE8E1377",
     "Arn"
    ]
   },
   "Export": {
    "Name": "ChatBooking-dev-Lambda:ExportsOutputFnGetAttRegisterTenantFunctionBE8E1377Arn1F9CA647"
   }
  },
  "ExportsOutputFnGetAttUpdateTenantFunction76E0A2E1Arn298E3814": {
   "Value": {
    "Fn::GetAtt": [
     "UpdateTenantFunction76E0A2E1",
     "Arn"
    ]
   },
   "Export": {
    "Name": "ChatBooking-dev-Lambda:ExportsOutputFnGetAttUpdateTenantFunction76E0A2E1Arn298E3814"
   }
  }
 },
 "Parameters": {
  "BootstrapVersion": {
   "Type": "AWS::SSM::Parameter::Value<String>",
   "Default": "/cdk-bootstrap/hnb659fds/version",
   "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]"
  }
 },
 "Rules": {
  "CheckBootstrapVersion": {
   "Assertions": [
    {
     "Assert": {
      "Fn::Not": [
       {
        "Fn::Contains": [
         [
          "1",
          "2",
          "3",
          "4",
          "5"
         ],
         {
          "Ref": "BootstrapVersion"
         }
        ]
       }
      ]
     },
     "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI."
    }
   ]
  }
 }
}